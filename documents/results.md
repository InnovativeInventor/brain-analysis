## Introduction (Brief Summary)

We are interested in how the human reacts differently when we are imagining natural scene images versus viewing the actual images themselves. The brain activity dataset was obtained from a public OpenNeuro database (Shen, 2018). We extracted the connectivity between different regions of the brain for the 2 conditions: imagining pictures vs. viewing images, by calculating the Pearson's R correlation for the activity of these regions as time series. The brain regions that we are interested in forms the human scene network that was proposed to encode the concept as well as spatial informations embedded in natural scenes (Baldassano, 2016).

We obtained 2 graphs corresponding to brain's reaction under the 2 conditions and performed 2 algorithms, PageRank and Girvan-Newman on both to make a comparison. Based on the known property of the general structure of the brain that more anterior (in the front) part are usually responsible for more abstract and higher level of processing, we hypothesize that we may see higher importance and stronger community structure in the anterior regions when people are imagining pictures compared to when they are viewing the same set of pictures.

## Methods (Algorithms Used)

### PageRank

We chose PageRank to identify voxel regions in the brain that are most "authoritative". As our correlations between voxel regions in the brain form an undirected graph, voxel regions with a high rank will correspond to regions of the brain that correlate highly with the activations of other regions of the brain

To perform PageRank, we first find the sum of weights on edges coming out of every vertex. This will be used to determine the portion of overall weight coming out of a vertex a particular edge holds. We also initialize the rank of every vertex to be 1 divided by the number of vertices (ranks start at equal value).

Next, we repeat the core update loop for a fixed number of iterations. The core update loop consists of accumulating the ranks of all vertices with edges with a particular vertex, divided by the total amount of weight coming out of each of those vertices. In other words, the rank of a particular vertex is updated to be the sum of the ranks of all adjacent vertices, multiplied by the fraction of those vertices' weight going into the vertex we are updating. Finally, we update all ranks by scaling down the calculated rank slightly and adding a damping factor.

To test for correctness, we took two approaches. First, we tested that the PageRank on small graphs matched exactly results that we computed by hand (the testing graphs in this section are small enough such that this was feasible). Second, we tested for various invariants of PageRank. For example, we test that graphs that are just large cycles have equally weighted ranks. That is, we ran PageRank on graphs where node 1 has an edge directed at node 2, node 2 has an edge directed at node 3, and so on, until the edge from node k to node 1 (k is the size of the graph). We tested PageRank on both unicycles and dicycles (directed vs undirected edges). In this scenario, an invariant of PageRank is that no matter the number of iterations run, the rank of each vertex should be 1 / k. We tested this for multiple sizes k. We also tested that the PageRank of a graph is not affected by normalization. Because the amount of "rank" that accumulates in a vertex depends on the fraction of weight on a particular edge, but not the magnitude of the edge weight, normalizing all the weights of all the edges coming out of all the vertices should have no affect on PageRank. We tested this to make sure our PageRank implementation respected this invariant.

### Girvan-Newman

We chose the Girvan-Newman algorithm for finding community structure (Newman & Girvan, 2004). The girvan-newman algorithm partitions the graph into different communities by finding the edges that are most likely to lie in between communities and removing them. The betweenness centrality of each edge is used to determine which edge to be removed and the process is repeated until teh graph partitioning is satisfying as quantified by the modularity quality function. The algorithm can be summarized as:

1. Calculate betweenness centrality for all edges;
2. Remove the edge with highest betweenness centrality score;
3. Calculate the graph's modularity score;
4. If modularity reached the pre-specified satisfying level then stop, else repeat from step 1.

The edge betweenness centrality scores were calculated using the Brandes algorithm (Brandes, 2001). The original algorithm was tailored for calculating vertex betweenness centrality scores for undirected and unweighted graph, so we added variants to calculate for edges in a weighted and undirected graph (Brandes, 2008). The weights in the modification suggested for valued graph indicated the distance between vertices, but the weights of the egges in our graph represents correlations, or how strongly connected each pair of vertex is, so we transformed weights by taking (1-w) to match the algorithm. This tranformation choice aligns with the use of Pearson's R correlation for edges weights, so our original weights can only be between 0 and 1. The modification used to accomodate the calculation of betweenness centrality for edges as opposed to vertices is simply to maintain the list of centralities for edges rather than vertices.

To calculate betweenness centrality scores, we not only need to obtain all pair-wise shortest paths, but also need to find out for a specific edge the number of shortest path that it lies on, or to sum up all the pair-wise dependency for this specific edge. Brandes algorithm improves the running time and storage required by augmenting the regular BFS algorithm so that we can only solve the single source shortest path once for each vertex and simply accumulate the betweenness centrality scores along the way. Our algorithm, therefore, starts with the regular BFS implementation with the modification mentioned above for weighted edges. At the end of each iteration for the specific source vertex, we backtraced to traverse the vertices visited so far to accumulate the dependencies to be added to the centrality scores for each edge. 

After the calculation of edge betweenness centrality, we removed the edge with the highest score and calculated the modularity. The modularity score is often used as a measure of how good the graph partitioning is (Newman, 2004). We used modularity score to optimize community detection. The modularity score is calculated by summing the probability that the edge is within a cluster minus the probability a random edge is within a certain cluster. High modularity indicates a larger number of edges within the group we expect by chance. After each edge removal, we recompute the modularity score and repeat the betweenness centrality caluclation and edge removal until we reach a modularity score of 0.3.

To test the correctness of the algorithms, first, we made sure that our algorithm calculates the modularity score and assigns the clusters correctly. We created a small graph and calculated the modularity score by hand and made sure that it matches the score calculated by our algorithm. We also checked to make sure that nodes within the same cluster have the same community membership value.

Next, to ensure that our Brandes algorithm is working correctly, we created a few smaller graphs to test our algorithm. We computed the betweenness centrality score manually and made sure that it matches the score calculated by the algorithm.

Lastly, we also tested our Girvan-Newman algorithm. The Girvan-Newman algorithm starts by calculating the modularity score, deletes the edge with the highest betweenness centrality score, and recalculates the modularity score. We manually identified the edge with the highest betweenness centrality score and made sure that it matches the edge removed by the Girvan-Newman algorithm.

## Results and Conclusions (The answer to leading question)

### PageRank Results

Based on our results from the PageRank algorithm, we managed to detect the brain regions that are important in both Imagery (i.e. imagining natural scenes) and Perception (i.e. viewing natural scenes) conditions. Interestingly, we found that the important brain areas are different between these two conditions. In the Imagery condition, the most important brain areas are located towards the back of the brain, whereas in the Perception condition, the most important brain areas are located at the middle part of the brain.

### Girvan-Newman Results

Another aspect that we were interested in is whether different groups of brain areas are at work for imagery compared to perception conditions. The logic is that because the more anterior (in the front) areas of the brain are responsible for more abstract or higher level of processing, we should perhaps see community structures in the front areas such as hippocampus or the memory region for imagery condition, since people are trying to remember or generating the images from within their mind. However, we are seeing the strong connectivity or close community structure between the areas in the back for both conditions. This may seem counterintuitive, because the back regions, especially the lower one responds to incoming visual signals. The areas in the back of our brain, in another word, are usually activated when we are actually viewing things. Therefore, our results aligns with the common mind's eye idea positing that when we imagining or visualizing scenes in our mind, the process is indeed similar to actually viewing them, therefore "seeing with mind's eye". 

Another interesting observation is that the intertalk between the memory areas in the 2 hemispheres is more anterior for the imagery condition. This corresponds to our hypothesis that perhaps when we are imagining, more anterior parts are involved and working harder to help us remember what the images look like. However, there aren't any significant community structures in the hippocampus, PPA and RSC area in the middle of the brain. This could be due to the fact that the images used in the experiment are not all strict scene images, so the actcivities in these regions may not be prominent enough to emerge. In addition, the way that the brain activity data were obtained could result in higher signal loss in the middle bottom portion of the brain, exactly where the hippocampus is in our case.

### General Conclusion
